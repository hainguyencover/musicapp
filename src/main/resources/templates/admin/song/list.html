<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head th:replace="~{layout/main :: head('Danh sách Bài hát')}"></head>
<body>

<header th:replace="~{layout/main :: header}"></header>

<div class="container">
    <!-- Messages -->
    <div th:if="${successMessage}" class="success-message">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
             stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 8px;">
            <polyline points="20 6 9 17 4 12"></polyline>
        </svg>
        <span th:text="${successMessage}"></span>
    </div>
    <div th:if="${errorMessage}" class="error-message">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
             stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 8px;">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="8" x2="12" y2="12"></line>
            <line x1="12" y1="16" x2="12.01" y2="16"></line>
        </svg>
        <span th:text="${errorMessage}"></span>
    </div>

    <!-- Action Bar -->
    <div class="action-bar">
        <a th:href="@{/admin/songs/create}" class="btn-add-new">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                 stroke="currentColor" stroke-width="2" style="margin-right: 8px;">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            Thêm bài hát mới
        </a>

        <!-- Search Form -->
        <form th:action="@{/admin/song}" method="get" class="mb-3">
            <div class="input-group">
                <input type="text" class="form-control" name="keyword" th:value="${keyword}"
                       placeholder="Tìm kiếm theo tên bài hát...">
                <button class="btn btn-primary" type="submit">Tìm kiếm</button>
                <a th:href="@{/admin/song}" class="btn btn-secondary">Xóa</a>
            </div>
        </form>
    </div>

    <!-- Songs Table -->
    <div class="table-container">
        <table>
            <thead>
            <tr>
                <th style="width: 60px;">ID</th>
                <th>
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                         stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 5px;">
                        <path d="M9 18V5l12-2v13"></path>
                        <circle cx="6" cy="18" r="3"></circle>
                        <circle cx="18" cy="16" r="3"></circle>
                    </svg>
                    Tên bài hát
                </th>
                <th style="width: 180px;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                         stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 5px;">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                    Nghệ sĩ
                </th>
                <th style="width: 150px;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                         stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 5px;">
                        <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path>
                        <line x1="7" y1="7" x2="7.01" y2="7"></line>
                    </svg>
                    Thể loại
                </th>
                <th style="width: 280px; text-align: center;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                         stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 5px;">
                        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                        <path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path>
                    </svg>
                    Nghe thử
                </th>
                <th style="width: 150px; text-align: center;">Hành động</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="song : ${songPage.content}">
                <td th:text="${song.id}"></td>
                <td>
                    <div class="song-title-cell">
                        <div class="song-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                 fill="currentColor">
                                <path d="M9 18V5l12-2v13"></path>
                                <circle cx="6" cy="18" r="3"></circle>
                                <circle cx="18" cy="16" r="3"></circle>
                            </svg>
                        </div>
                        <span th:text="${song.name}" class="song-title-text">Song Name</span>
                    </div>
                </td>
                <td>
                    <span class="artist-badge" th:text="${song.artist?.name}">Artist</span>
                </td>
                <td>
                    <span class="genre-badge" th:text="${song.genre?.name}">Genre</span>
                </td>
                <td style="text-align: center;">
                    <div class="audio-player-cell" th:if="${song.filePath != null}">
                        <audio controls class="custom-audio-player">
                            <source th:src="@{/songs/play/{filename}(filename=${song.filePath})}" type="audio/mpeg">
                        </audio>
                    </div>
                    <span th:if="${song.filePath == null}"
                          style="color: #a0aec0; font-style: italic; font-size: 0.85rem;">
                        Chưa có file
                    </span>
                </td>
                <td style="text-align: center;">
                    <div class="action-buttons">
                        <td>
                            <a th:href="@{/admin/songs/edit/{id}(id=${song.id})}">Sửa</a>
                            |
                            <a th:href="@{/admin/songs/delete/{id}(id=${song.id})}"
                               onclick="return confirm('Bạn có chắc chắn muốn xóa bài hát này?')">Xóa</a>
                        </td>
                    </div>
                </td>
            </tr>
            </tbody>
        </table>

        <!-- Empty State -->
        <div th:if="${songPage == null or songPage.isEmpty()}" class="empty-state">
            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none"
                 stroke="currentColor" stroke-width="2" style="color: #cbd5e0; margin-bottom: 1rem;">
                <path d="M9 18V5l12-2v13"></path>
                <circle cx="6" cy="18" r="3"></circle>
                <circle cx="18" cy="16" r="3"></circle>
            </svg>
            <h3 style="color: #718096; font-size: 1.2rem; margin-bottom: 0.5rem;">Không tìm thấy bài hát nào</h3>
            <p style="color: #a0aec0; font-size: 0.9rem;">
                <span th:if="${keyword != null and !keyword.isEmpty()}">
                    Không có kết quả cho "<strong th:text="${keyword}"></strong>"
                </span>
                <span th:if="${keyword == null or keyword.isEmpty()}">
                    Chưa có bài hát nào trong hệ thống
                </span>
            </p>
            <a th:href="@{/admin/songs/create}" class="btn-add-new" style="margin-top: 1.5rem;">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                     stroke="currentColor" stroke-width="2" style="margin-right: 6px;">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
                Thêm bài hát đầu tiên
            </a>
        </div>
    </div>

    <!-- Pagination -->
    <div th:if="${songPage != null and songPage.totalPages > 0}" class="pagination">
        <span th:text="|Trang ${songPage.number + 1} / ${songPage.totalPages}|"></span>
        <nav aria-label="Page navigation">
            <ul class="pagination">
                <li class="page-item" th:classappend="${songPage.first} ? 'disabled'">
                    <a class="page-link"
                       th:href="@{/admin/songs(size=${songPage.size}, page=0, sort=${param.sort}, keyword=${keyword})}"
                       title="Trang đầu">&laquo;</a>
                </li>
                <li class="page-item" th:classappend="${songPage.first} ? 'disabled'">
                    <a class="page-link"
                       th:href="@{/admin/songs(size=${songPage.size}, page=${songPage.number - 1}, sort=${param.sort}, keyword=${keyword})}"
                       th:if="${!songPage.first}"
                       title="Trang trước">&lsaquo;</a>
                    <span class="page-link" th:if="${songPage.first}" title="Trang trước">&lsaquo;</span>
                </li>
                <th:block th:with="
                    currentPage=${songPage.number},
                    totalPages=${songPage.totalPages},
                    startPage=${T(java.lang.Math).max(0, currentPage - 2)},
                    endPage=${T(java.lang.Math).min(totalPages - 1, currentPage + 2)}">
                    <li class="page-item" th:each="i : ${#numbers.sequence(startPage, endPage)}"
                        th:classappend="${i == currentPage} ? 'active'">
                        <a class="page-link"
                           th:href="@{/admin/songs(size=${songPage.size}, page=${i}, sort=${param.sort}, keyword=${keyword})}"
                           th:text="${i + 1}"></a>
                    </li>
                </th:block>
                <li class="page-item" th:classappend="${songPage.last} ? 'disabled'">
                    <a class="page-link"
                       th:href="@{/admin/songs(size=${songPage.size}, page=${songPage.number + 1}, sort=${param.sort}, keyword=${keyword})}"
                       th:if="${!songPage.last}"
                       title="Trang sau">&rsaquo;</a>
                    <span class="page-link" th:if="${songPage.last}" title="Trang sau">&rsaquo;</span>
                </li>
                <li class="page-item" th:classappend="${songPage.last} ? 'disabled'">
                    <a class="page-link"
                       th:href="@{/admin/songs(size=${songPage.size}, page=${songPage.totalPages - 1}, sort=${param.sort}, keyword=${keyword})}"
                       title="Trang cuối">&raquo;</a>
                </li>
            </ul>
        </nav>
    </div>
</div>

<footer th:replace="~{layout/main :: footer}"></footer>

</body>
</html>
